{
    "id": "a7cd4ea2-0b83-49cb-887a-b529e5d80db7",
    "name": "PublishToADX",
    "friendlyName": "Run Azure Data Explorer Command",
    "description": "Run admin command Kusto (ADX) databases",
    "helpMarkDown": "[Contact Us](mailto:kustoops@microsoft.com)",
    "category": "Utility",
    "author": "Microsoft Corporation",
    "version": {
      "Major": 1,
      "Minor": 0,
      "Patch": 94
    },
    "instanceNameFormat": "Kusto Command",
    "groups": [
      {
          "name": "advanced",
          "displayName": "Advanced",
          "isExpanded": false
      }
    ],
    "inputs": [
      {
        "name": "targetType",
        "type": "radio",
        "label": "Type",
        "required": false,
        "defaultValue": "filePath",
        "helpMarkDown": "Target script type: File Path or Inline",
        "options": {
            "filePath": "File Path",
            "inline": "Inline"
        }
      },
      {
        "name": "files",
        "type": "multiLine",
        "label": "Files",
        "defaultValue": "**/*.csl",
        "required": true,
        "visibleRule": "targetType = filePath",
        "properties": {
          "resizable": "true",
          "rows": "5",
          "maxLength": "1000"
      },
        "helpMarkDown": "Kusto scripts to execute. See [file matching patterns](https://docs.microsoft.com/en-us/vsts/build-release/tasks/file-matching-patterns?view=vsts) for syntax."
      },
      {
        "name": "script",
        "type": "multiLine",
        "label": "Script",
        "visibleRule": "targetType = inline",
        "required": false,
        "defaultValue": "# Write your command here.\n.show version \n# Use the environment variables input below to pass secret variables to this script.\n# Do not add empty lines, supports only single command",
        "properties": {
            "resizable": "true",
            "rows": "5",
            "maxLength": "5000"
        },
        "helpMarkDown": ""
      },
      {
        "name": "singleCommand",
        "type": "boolean",
        "label": "Single Kusto command per file",
        "defaultValue": false,
        "required": false,
        "visibleRule": "targetType = filePath",
        "helpMarkDown": "When checked, empty lines are considered part of commands and each script file must only contain a single command. When unchecked, empty lines are treated as command separators and multiple commands can appear in script files. "
      },
      {
        "name": "waitFoeOperation",
        "type": "boolean",
        "label": "Wait for long Async Admin commands to complete (polling \".show operations <Guid>\")",
        "defaultValue": false,
        "required": false,
        "helpMarkDown": "When checked, empty lines are considered part of commands and each script file must only contain a single command. When unchecked, empty lines are treated as command separators and multiple commands can appear in script files. "
      },
      {
        "name": "waitTimeout",
        "type": "string",
        "label": "Wait Timeout",
        "defaultValue": "0",
        "required": false,
        "helpMarkDown": "Maximum time to wait for long running commands (0 = no timeout)."
      },
      {
        "name": "kustoUrls",
        "type": "string",
        "label": "Endpoint URLs",
        "defaultValue": "https://[YourCluster].kusto.windows.net:443?DatabaseName=[YourDatabase]",
        "required": true,
        "helpMarkDown": "Semicolon-separated list of URLs of the Kusto clusters and databases to deploy to, each formatted as 'https://[YourCluster].kusto.windows.net:443?DatabaseName=[YourDatabase]'."
      },
      {
        "name": "aadClientId",
        "type": "string",
        "label": "AAD App Id",
        "defaultValue": "",
        "required": true,
        "helpMarkDown": "The GUID of the AAD App authorized to run admin commands on the Kusto database."
      },
      {
        "name": "ResourceURI",
        "type": "string",
        "label": "Resource URI",
        "defaultValue": "https://[YourCluster].kusto.windows.net",
        "required": true,
        "helpMarkDown": "The Resource providing the OAuth token for the command (base url of your cluster) ."
      },
      {
        "name": "aadClientSecret",
        "type": "string",
        "label": "AAD App Key",
        "defaultValue": "",
        "required": true,
        "helpMarkDown": "The client secret used to authenticate with AAD."
      },
      {
        "name": "tenantId",
        "type": "string",
        "label": "AAD Tenant Id",
        "defaultValue": "microsoft.onmicrosoft.com",
        "required": true,
        "helpMarkDown": "The AAD Tenant ID (<Org>.onmicrosoft.com or tenantID Guid)"
      },
      {
        "name": "OutputVariable",
        "type": "string",
        "label": "Output Variable",
        "defaultValue": "",
        "helpMarkDown": "Provide the variable name for the (last) command response output (to use in downstream tasks - value is in JSON format)",
        "groupName": "advanced"
      },
      {
        "name": "workDir",
        "type": "filePath",
        "label": "Working Directory",
        "defaultValue": "$(System.DefaultWorkingDirectory)",
        "helpMarkDown": "Root Path to search the *.csl files",
        "groupName": "advanced"
      }
    ],
    "execution": {
      "Node": {
        "target": "src/index.js"
      }
    }
  }
