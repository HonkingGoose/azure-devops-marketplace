{
    "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
    "id": "0a3b12a2-9178-482b-9bf3-ff9af4ce9a3c",
    "name": "multiDockerBuild",
    "friendlyName": "Multi Docker Build",
    "description": "Build docker images from any number of dockerfiles in your code repo. Configurable dockerfile paths, image names and tags. Use secrets for repository credentials, to keep everything 'service connection' free!",
	"helpUrl": "https://www.parksq.co.uk/azure-dev-ops/multi-docker-build",
	"helpMarkDown": "[Learn more about this task](https://www.parksq.co.uk/azure-dev-ops/multi-docker-build-extension)",
    "category": "Azure Pipelines",
	"visibility": [
        "Build",
        "Release"
    ],
    "author": "Park Square Consulting Ltd",
    "version": {
        "Major": 0,
        "Minor": 1,
        "Patch": 12
    },
    "instanceNameFormat": "Multi Docker Build $(configPath)",
	"groups": [
        {
            "name": "containerRepository",
            "displayName": "Container Repository",
            "isExpanded": true
        },
        {
            "name": "command",
            "displayName": "Command",
            "isExpanded": true
        }
    ],
    "inputs": [
		{
            "name": "registryUrl",
            "type": "string",
            "label": "Registry URL",
            "required": true,
            "helpMarkDown": "Container registry URL",
			"groupName": "containerRepository"
		},
		{
            "name": "registryUsername",
            "type": "string",
            "label": "Username",
            "required": true,
            "helpMarkDown": "Username to log into registry with",
			"groupName": "containerRepository"
		},
		{
            "name": "registryPassword",
            "type": "string",
            "label": "Password",
            "required": true,
            "helpMarkDown": "Password to log into registry with",
			"groupName": "containerRepository"
		},
		{
            "name": "repositoryName",
            "type": "string",
            "label": "Repository Name",
            "required": true,
            "helpMarkDown": "Repository name, e.g. for foo.bar.com/myrepo/yourimage:sometag enter 'myrepo' here",
			"groupName": "containerRepository"
		},
		{
            "name": "multiImageBuild",
            "type": "boolean",
            "label": "Build Multiple Images",
            "defaultValue": true,
            "required": true,
            "helpMarkDown": "Check to read Dockerfile/image name configuration from file to build multiple images. Uncheck to build a single image and specify the Dockerfile path",
			"groupName": "command"
        },
		{
            "name": "singleModeDockerfilePath",
            "type": "filePath",
            "label": "Dockerfile Path",
            "defaultValue": "Dockerfile",
            "required": false,
            "helpMarkDown": "Location of Dockerfile to build",
			"groupName": "command",
			"visibleRule": "multiImageBuild = false"
        },
		{
            "name": "singleModeImageName",
            "type": "string",
            "label": "Image Name",
            "defaultValue": "$(Build.Repository.Name)",
            "required": false,
            "helpMarkDown": "Image Name",
			"groupName": "command",
			"visibleRule": "multiImageBuild = false"
        },
		{
            "name": "singleModeContextPath",
            "type": "string",
            "label": "Context Path",
            "defaultValue": "$(Build.ArtifactStagingDirectory)",
            "required": false,
            "helpMarkDown": "Context Path",
			"groupName": "command",
			"visibleRule": "multiImageBuild = false"
        },
        {
            "name": "multiModeConfigPath",
            "type": "filePath",
            "label": "Configuration File Path",
            "defaultValue": "docker-build-config.json",
            "required": false,
            "helpMarkDown": "Location of docker build configuration path",
			"groupName": "command",
			"visibleRule": "multiImageBuild = true"
        },
        {
            "name": "tags",
            "type": "multiLine",
            "label": "Tags",
            "defaultValue": "$(Build.BuildNumber)\r\nlatest",
            "required": false,
            "helpMarkDown": "Tags to apply to the built image(s)",
			"groupName": "command"
        },
        {
            "name": "pushAfterBuild",
            "type": "boolean",
            "label": "Push After Build",
            "defaultValue": false,
            "required": true,
            "helpMarkDown": "If selected, will also push the image to your container repository once built",
			"groupName": "command"
        }
	],
    "execution": {
        "Node10": {
            "target": "index.js"
        }
    }
}
